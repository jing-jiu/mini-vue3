{"code":"import { isArray, isObject, hasOwn, isIntegerKey, hasChanged } from \"@vue/shared\";\r\nimport { track, trigger } from \"./effect\";\r\nimport { reactive, readonly } from \"./reactive\";\r\nconst get = createGetter();\r\nconst shallowGet = createGetter(false, true);\r\nconst readonlyGet = createGetter(true);\r\nconst shallowReadonlyGet = createGetter(true, true);\r\nconst set = createSetter();\r\nconst shallowSet = createSetter(true);\r\n/**\r\n *\r\n * @param isReadonly 是否只读\r\n * @param shallow  是否浅相应\r\n */\r\nfunction createGetter(isReadonly = false, shallow = false) {\r\n    return function get(target, key, receiver) {\r\n        const res = Reflect.get(target, key, receiver);\r\n        if (!isReadonly) {\r\n            // 可写的才收集依赖\r\n            console.log(\"收集依赖\", key);\r\n            track(target, \"TrackOpTypes.GET\", key);\r\n        }\r\n        if (shallow) {\r\n            // 浅响应不用返回代理\r\n            return res;\r\n        }\r\n        if (isObject(res)) {\r\n            // 结果是对象 判断对象响应式的状态 进行不同的处理\r\n            return isReadonly ? readonly(res) : reactive(res);\r\n        }\r\n        return res;\r\n    };\r\n}\r\nfunction createSetter(shallow = false) {\r\n    return function set(target, key, value, receiver) {\r\n        const oldValue = target[key];\r\n        const hadKey = isArray(target) && isIntegerKey(key) ? Number(key) < target.length : hasOwn(target, key);\r\n        const result = Reflect.set(target, key, value, receiver);\r\n        if (!hadKey) {\r\n            // 新增属性\r\n            trigger(target, \"TriggerOpTypes.ADD\", key, value);\r\n        }\r\n        else if (hasChanged(value, oldValue)) {\r\n            // 修改属性\r\n            trigger(target, \"TriggerOpTypes.SET\", key, value, oldValue);\r\n        }\r\n        return result;\r\n    };\r\n}\r\nexport const mutableHandlers = {\r\n    get, set\r\n};\r\nexport const shallowReactiveHandlers = {\r\n    get: shallowGet,\r\n    set: shallowSet\r\n};\r\nexport const readonlyHandlers = {\r\n    get: readonlyGet,\r\n    set(target, key) {\r\n        console.warn(`Set operation on key \"${String(key)}\" failed: target is readonly.`);\r\n        return true;\r\n    }\r\n};\r\nexport const shallowReadonlyHandlers = {\r\n    get: shallowReadonlyGet,\r\n    set(target, key) {\r\n        console.warn(`Set operation on key \"${String(key)}\" failed: target is readonly.`);\r\n        return true;\r\n    }\r\n};\r\n//# sourceMappingURL=baseHandlers.js.map","references":["C:/Users/惠新浩/Desktop/Task/Web/Vue/手写vue/vue3/packages/shared/src/index.ts","C:/Users/惠新浩/Desktop/Task/Web/Vue/手写vue/vue3/packages/reactivity/src/effect.ts","C:/Users/惠新浩/Desktop/Task/Web/Vue/手写vue/vue3/packages/reactivity/src/reactive.ts"],"map":"{\"version\":3,\"file\":\"baseHandlers.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../packages/reactivity/src/baseHandlers.ts\"],\"names\":[],\"mappings\":\"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\"}"}
